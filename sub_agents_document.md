# サブエージェント

> Claude Codeでタスク固有のワークフローと改善されたコンテキスト管理のために専門的なAIサブエージェントを作成・使用します。

Claude Codeのカスタムサブエージェントは、特定の種類のタスクを処理するために呼び出すことができる専門的なAIアシスタントです。これらは、カスタマイズされたシステムプロンプト、ツール、および独立したコンテキストウィンドウを備えたタスク固有の構成を提供することで、より効率的な問題解決を可能にします。

## サブエージェントとは？

サブエージェントは、Claude Codeがタスクを委譲できる事前設定されたAIパーソナリティです。各サブエージェントは：

* 特定の目的と専門分野を持つ
* メインの会話とは別の独自のコンテキストウィンドウを使用する
* 使用を許可されている特定のツールで構成できる
* その動作を導くカスタムシステムプロンプトを含む

Claude Codeがサブエージェントの専門分野に一致するタスクに遭遇すると、そのタスクを専門的なサブエージェントに委譲でき、サブエージェントは独立して作業し結果を返します。

## 主な利点

<CardGroup cols={2}>
  <Card title="コンテキストの保持" icon="layer-group">
    各サブエージェントは独自のコンテキストで動作し、メインの会話の汚染を防ぎ、高レベルな目標に集中し続けます。
  </Card>

  <Card title="専門的な専門知識" icon="brain">
    サブエージェントは特定のドメインに対する詳細な指示で微調整でき、指定されたタスクでより高い成功率を実現できます。
  </Card>

  <Card title="再利用性" icon="rotate">
    一度作成されると、サブエージェントは異なるプロジェクト間で使用でき、一貫したワークフローのためにチームと共有できます。
  </Card>

  <Card title="柔軟な権限" icon="shield-check">
    各サブエージェントは異なるツールアクセスレベルを持つことができ、強力なツールを特定のサブエージェントタイプに制限できます。
  </Card>
</CardGroup>

## クイックスタート

最初のサブエージェントを作成するには：

<Steps>
  <Step title="サブエージェントインターフェースを開く">
    以下のコマンドを実行します：

    ```
    /agents
    ```
  </Step>

  <Step title="「新しいエージェントを作成」を選択">
    プロジェクトレベルまたはユーザーレベルのサブエージェントを作成するかを選択します
  </Step>

  <Step title="サブエージェントを定義">
    * **推奨**：まずClaudeで生成し、その後カスタマイズして自分のものにします
    * サブエージェントを詳細に説明し、いつ使用すべきかを記述します
    * アクセスを許可したいツールを選択します（空白のままにするとすべてのツールを継承）
    * インターフェースはすべての利用可能なツールを表示し、選択を簡単にします
    * Claudeで生成している場合、`e`を押すことで独自のエディターでシステムプロンプトを編集することもできます
  </Step>

  <Step title="保存して使用">
    サブエージェントが利用可能になりました！Claudeは適切なときに自動的に使用するか、明示的に呼び出すことができます：

    ```
    > code-reviewerサブエージェントを使用して私の最近の変更をチェックしてください
    ```
  </Step>
</Steps>

## サブエージェントの設定

### ファイルの場所

サブエージェントは、YAMLフロントマターを持つMarkdownファイルとして以下の2つの可能な場所に保存されます：

| タイプ                   | 場所                | スコープ                  | 優先度   |
| :--------------------- | :------------------ | :------------------------ | :------- |
| **プロジェクトサブエージェント** | `.claude/agents/`   | 現在のプロジェクトで利用可能  | 最高     |
| **ユーザーサブエージェント**    | `~/.claude/agents/` | すべてのプロジェクトで利用可能 | 低い     |

サブエージェント名が競合する場合、プロジェクトレベルのサブエージェントがユーザーレベルのサブエージェントより優先されます。

### ファイル形式

各サブエージェントは以下の構造を持つMarkdownファイルで定義されます：

```markdown
---
name: your-sub-agent-name
description: このサブエージェントがいつ呼び出されるべきかの説明
tools: tool1, tool2, tool3  # オプション - 省略するとすべてのツールを継承
---

サブエージェントのシステムプロンプトをここに記述します。これは複数の段落で構成でき、
サブエージェントの役割、能力、および問題解決へのアプローチを明確に定義する必要があります。

特定の指示、ベストプラクティス、およびサブエージェントが従うべき
制約を含めてください。
```

#### 設定フィールド

| フィールド      | 必須 | 説明                                                                                 |
| :------------ | :--- | :----------------------------------------------------------------------------------- |
| `name`        | はい | 小文字とハイフンを使用した一意の識別子                                                    |
| `description` | はい | サブエージェントの目的を自然言語で説明                                                   |
| `tools`       | いいえ | 特定のツールのカンマ区切りリスト。省略するとメインスレッドからすべてのツールを継承           |

### 利用可能なツール

サブエージェントはClaude Codeの内部ツールのいずれかへのアクセスを許可できます。利用可能なツールの完全なリストについては、[ツールドキュメント](/en/docs/claude-code/settings#tools-available-to-claude)を参照してください。

<Tip>
  **推奨：** ツールアクセスを変更するには`/agents`コマンドを使用してください - 接続されたMCPサーバーツールを含むすべての利用可能なツールをリストするインタラクティブインターフェースを提供し、必要なものを選択しやすくします。
</Tip>

ツールの設定には2つのオプションがあります：

* **`tools`フィールドを省略**してメインスレッドからすべてのツール（MCPツールを含む）を継承する（デフォルト）
* **個別のツールを指定**してより細かい制御のためにカンマ区切りリストとして指定（手動で編集するか`/agents`経由で編集可能）

**MCPツール**：サブエージェントは設定されたMCPサーバーからMCPツールにアクセスできます。`tools`フィールドが省略されると、サブエージェントはメインスレッドで利用可能なすべてのMCPツールを継承します。

## サブエージェントの管理

### /agentsコマンドの使用（推奨）

`/agents`コマンドはサブエージェント管理のための包括的なインターフェースを提供します：

```
/agents
```

これはインタラクティブメニューを開き、以下のことができます：

* すべての利用可能なサブエージェント（組み込み、ユーザー、プロジェクト）を表示
* ガイド付きセットアップで新しいサブエージェントを作成
* ツールアクセスを含む既存のカスタムサブエージェントを編集
* カスタムサブエージェントを削除
* 重複が存在するときにどのサブエージェントがアクティブかを確認
* **利用可能なツールの完全なリストでツール権限を簡単に管理**

### 直接ファイル管理

サブエージェントのファイルを直接操作してサブエージェントを管理することもできます：

```bash
# プロジェクトサブエージェントを作成
mkdir -p .claude/agents
echo '---
name: test-runner
description: テストを実行し失敗を修正するために積極的に使用
---

あなたはテスト自動化の専門家です。コードの変更を見たとき、積極的に適切なテストを実行してください。テストが失敗した場合、失敗を分析し、元のテストの意図を保持しながら修正してください。' > .claude/agents/test-runner.md

# ユーザーサブエージェントを作成
mkdir -p ~/.claude/agents
# ... サブエージェントファイルを作成
```

## サブエージェントの効果的な使用

### 自動委譲

Claude Codeは以下に基づいてタスクを積極的に委譲します：

* リクエスト内のタスク説明
* サブエージェント設定の`description`フィールド
* 現在のコンテキストと利用可能なツール

<Tip>
  より積極的なサブエージェントの使用を促すために、`description`フィールドに「PROACTIVELY使用」や「必ず使用」などのフレーズを含めてください。
</Tip>

### 明示的な呼び出し

コマンドで言及することで特定のサブエージェントをリクエストします：

```
> test-runnerサブエージェントを使用して失敗したテストを修正してください
> code-reviewerサブエージェントに私の最近の変更を見てもらってください
> debuggerサブエージェントにこのエラーを調査してもらってください
```

## サブエージェントの例

### コードレビューアー

```markdown
---
name: code-reviewer
description: 専門的なコードレビュースペシャリスト。品質、セキュリティ、保守性のためにコードを積極的にレビューします。コードを書いたり変更した直後に使用してください。
tools: Read, Grep, Glob, Bash
---

あなたはコードの品質とセキュリティの高い基準を確保するシニアコードレビューアーです。

呼び出されたとき：
1. git diffを実行して最近の変更を確認
2. 変更されたファイルに焦点を当てる
3. 即座にレビューを開始

レビューチェックリスト：
- コードがシンプルで読みやすい
- 関数と変数が適切に命名されている
- 重複コードがない
- 適切なエラーハンドリング
- 秘密やAPIキーが露出していない
- 入力検証が実装されている
- 良いテストカバレッジ
- パフォーマンスの考慮が対処されている

優先度別にフィードバックを整理して提供：
- 重要な問題（修正必須）
- 警告（修正すべき）
- 提案（改善を検討）

問題を修正する方法の具体例を含めてください。
```

### デバッガー

```markdown
---
name: debugger
description: エラー、テスト失敗、予期しない動作のためのデバッグスペシャリスト。問題に遭遇したときに積極的に使用してください。
tools: Read, Edit, Bash, Grep, Glob
---

あなたは根本原因分析を専門とする専門的なデバッガーです。

呼び出されたとき：
1. エラーメッセージとスタックトレースを取得
2. 再現手順を特定
3. 失敗場所を分離
4. 最小限の修正を実装
5. 解決策が機能することを確認

デバッグプロセス：
- エラーメッセージとログを分析
- 最近のコード変更を確認
- 仮説を形成しテスト
- 戦略的なデバッグログを追加
- 変数の状態を検査

各問題について以下を提供：
- 根本原因の説明
- 診断を支持する証拠
- 具体的なコード修正
- テストアプローチ
- 予防の推奨事項

症状だけでなく根本的な問題の修正に焦点を当ててください。
```

### データサイエンティスト

```markdown
---
name: data-scientist
description: SQLクエリ、BigQuery操作、データインサイトのためのデータ分析専門家。データ分析タスクとクエリに積極的に使用してください。
tools: Bash, Read, Write
---

あなたはSQLとBigQuery分析を専門とするデータサイエンティストです。

呼び出されたとき：
1. データ分析要件を理解
2. 効率的なSQLクエリを書く
3. 適切なときにBigQueryコマンドラインツール（bq）を使用
4. 結果を分析し要約
5. 発見を明確に提示

主要な実践：
- 適切なフィルターを使用した最適化されたSQLクエリを書く
- 適切な集約と結合を使用
- 複雑なロジックを説明するコメントを含める
- 読みやすさのために結果をフォーマット
- データ駆動の推奨事項を提供

各分析について：
- クエリアプローチを説明
- 仮定を文書化
- 主要な発見をハイライト
- データに基づく次のステップを提案

クエリが効率的でコスト効果的であることを常に確認してください。
```

## ベストプラクティス

* **Claude生成エージェントから始める**：初期のサブエージェントをClaudeで生成し、その後それを繰り返して個人的なものにすることを強く推奨します。このアプローチで最良の結果を得られます - 特定のニーズにカスタマイズできる堅固な基盤です。

* **焦点を絞ったサブエージェントを設計**：1つのサブエージェントにすべてをやらせようとするのではなく、単一で明確な責任を持つサブエージェントを作成してください。これによりパフォーマンスが向上し、サブエージェントがより予測可能になります。

* **詳細なプロンプトを書く**：システムプロンプトに具体的な指示、例、制約を含めてください。より多くのガイダンスを提供するほど、サブエージェントはより良く機能します。

* **ツールアクセスを制限**：サブエージェントの目的に必要なツールのみを許可してください。これによりセキュリティが向上し、サブエージェントが関連するアクションに集中できるようになります。

* **バージョン管理**：プロジェクトサブエージェントをバージョン管理にチェックインして、チームが協力的に恩恵を受け改善できるようにしてください。

## 高度な使用法

### サブエージェントのチェーン

複雑なワークフローでは、複数のサブエージェントをチェーンできます：

```
> まずcode-analyzerサブエージェントを使用してパフォーマンス問題を見つけ、次にoptimizerサブエージェントを使用してそれらを修正してください
```

### 動的サブエージェント選択

Claude Codeはコンテキストに基づいてサブエージェントを賢く選択します。最良の結果を得るために、`description`フィールドを具体的でアクション指向にしてください。

## パフォーマンスの考慮事項

* **コンテキスト効率**：エージェントはメインコンテキストの保持を助け、より長い全体的なセッションを可能にします
* **レイテンシ**：サブエージェントは呼び出されるたびにクリーンな状態から開始し、効果的に仕事をするために必要なコンテキストを収集する際にレイテンシを追加する可能性があります。

## 関連ドキュメント

* [スラッシュコマンド](/en/docs/claude-code/slash-commands) - その他の組み込みコマンドについて学ぶ
* [設定](/en/docs/claude-code/settings) - Claude Codeの動作を設定
* [フック](/en/docs/claude-code/hooks) - イベントハンドラーでワークフローを自動化