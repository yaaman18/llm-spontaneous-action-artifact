[tool:pytest]
# テストディレクトリとファイルパターン
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# カスタムマーカーの定義
markers =
    unit: ユニットテスト - 高速で独立したテスト
    integration: 統合テスト - 複数コンポーネントの連携テスト
    e2e: エンドツーエンドテスト - システム全体の動作テスト
    emergence: 創発現象のテスト - 非決定的な振る舞いのテスト
    slow: 実行時間の長いテスト
    asyncio: 非同期処理のテスト
    phenomenology: 現象学的側面のテスト
    autopoiesis: オートポイエーシスのテスト

# デフォルトオプション
addopts = 
    # 厳密なマーカーチェック
    --strict-markers
    # カバレッジ測定
    --cov=src
    --cov-report=html
    --cov-report=term-missing:skip-covered
    # カバレッジ基準
    --cov-fail-under=85
    # 詳細な出力
    -vv
    # テスト実行時間の表示
    --durations=10
    # 失敗時の詳細表示
    --tb=short
    # 並列実行の設定（CPUコア数の半分）
    -n auto
    # ランダム実行順序（依存関係の検出）
    --random-order

# テストのタイムアウト設定
timeout = 300
timeout_method = thread

# アサーションの詳細表示
[tool:pytest:assertrepr]
verbose = 2

# カバレッジ設定
[coverage:run]
branch = True
source = src/
omit = 
    */tests/*
    */test_*.py
    */__pycache__/*
    */venv/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False
sort = Cover

# HTML カバレッジレポート
[coverage:html]
directory = htmlcov

# 特定のテストグループ実行用エイリアス
[aliases]
test-unit = pytest -m unit
test-integration = pytest -m integration
test-e2e = pytest -m e2e
test-fast = pytest -m "not slow"
test-all = pytest