# エナクティブ意識フレームワーク実行ガイド
## ターミナルコマンド集

**更新日**: 2025年1月10日  
**フレームワークバージョン**: v1.0  
**対象ディレクトリ**: `/sandbox/tools/10_8_2025/enactive-consciousness/`

---

## **🚀 基本実行コマンド**

### **1. コアシステム検証**
```bash
# エナクティブ意識フレームワークの基本動作確認
python simple_system_test.py

# 期待される出力:
# ✅ Information theory module loaded successfully
# 🚀 Enhanced Enactive Consciousness Score Validation
# Final Results: Enhanced validation score: 1.000
# 🎉 SUCCESS: Enhanced system achieves target performance!
```

### **2. 個別モジュール動作確認**
```bash
# 時間意識モジュール単体テスト
python -c "
from src.enactive_consciousness.temporal import PhenomenologicalTemporalSynthesis, TemporalConsciousnessConfig
import jax
key = jax.random.PRNGKey(42)
config = TemporalConsciousnessConfig()
processor = PhenomenologicalTemporalSynthesis(config, 32, key)
test_input = jax.random.normal(key, (32,))
result = processor.temporal_synthesis(test_input)
print(f'時間意識処理成功: {result.present_moment.shape}')
"

# 身体図式統合テスト
python -c "
from src.enactive_consciousness.embodiment import BodySchemaIntegration, BodySchemaConfig
import jax
key = jax.random.PRNGKey(42)
config = BodySchemaConfig()
processor = BodySchemaIntegration(config, key)
prop_input = jax.random.normal(key, (64,))
motor_input = jax.random.normal(key, (32,))
tactile_input = jax.random.normal(key, (32,))
result = processor.integrate_body_schema(prop_input, motor_input, tactile_input)
print(f'身体図式統合成功: 信頼度={result.schema_confidence:.3f}')
"
```

---

## **🧪 テスト実行コマンド**

### **1. 全テスト実行**
```bash
# すべてのテストを実行 (推奨)
python -m pytest tests/ -v --tb=short

# カバレッジ付きテスト実行
python -m pytest tests/ --cov=src --cov-report=html --cov-report=term

# 高速テスト実行 (失敗したら停止)
python -m pytest tests/ -x --tb=short
```

### **2. 個別モジュールテスト**
```bash
# 時間意識テスト
python -m pytest tests/test_motor_schema_gru_temporal.py -v

# 身体化認知テスト
python -m pytest tests/test_equinox_state_management_corrected.py -v

# 円環因果性テスト
python -m pytest tests/test_circular_causality_state.py -v

# RNN統合テスト
python -m pytest tests/test_rnn_integration.py -v
```

### **3. 統合テスト**
```bash
# 包括的統合テスト
python run_integration_tests.py

# 基本統合テストのみ (高速)
python run_integration_tests.py --suite basic

# パフォーマンス統合テスト
python run_integration_tests.py --suite performance

# すべての統合テスト (時間かかります)
python run_integration_tests.py --suite all

# カバレッジ付き統合テスト
python run_integration_tests.py --coverage
```

### **4. 包括的テストスイート**
```bash
# 新規作成された包括的テスト (345+ テスト)
python run_comprehensive_tests.py

# 情報理論テスト
python run_comprehensive_tests.py --module information_theory

# 動的ネットワークテスト  
python run_comprehensive_tests.py --module dynamic_networks

# スパース表現テスト
python run_comprehensive_tests.py --module sparse_representations

# 予測コーディングテスト
python run_comprehensive_tests.py --module predictive_coding

# 連続動力学テスト
python run_comprehensive_tests.py --module continuous_dynamics
```

---

## **⚡ パフォーマンス・最適化**

### **1. JIT最適化検証**
```bash
# JITコンパイル動作確認
python test_jit_fixes.py

# JIT vs Non-JIT性能比較
python -c "
from src.enactive_consciousness.jit_utils import compare_jit_performance
from src.enactive_consciousness.temporal import create_temporal_processor, create_temporal_processor_no_jit, TemporalConsciousnessConfig
import jax

key = jax.random.PRNGKey(42)
config = TemporalConsciousnessConfig()
result = compare_jit_performance(
    create_temporal_processor, 
    create_temporal_processor_no_jit,
    config, 32, key
)
print(f'JIT性能向上: {result[\"speedup\"]:.2f}x')
"
```

### **2. メモリプロファイリング**
```bash
# メモリ使用量チェック
python -c "
import psutil
import gc
from src.enactive_consciousness.temporal import PhenomenologicalTemporalSynthesis, TemporalConsciousnessConfig
import jax

# メモリ使用量測定
process = psutil.Process()
initial_memory = process.memory_info().rss / 1024 / 1024

key = jax.random.PRNGKey(42)
config = TemporalConsciousnessConfig()
processor = PhenomenologicalTemporalSynthesis(config, 64, key)

for i in range(100):
    test_input = jax.random.normal(key, (64,))
    result = processor.temporal_synthesis(test_input)
    
current_memory = process.memory_info().rss / 1024 / 1024
print(f'メモリ使用量: {initial_memory:.1f}MB → {current_memory:.1f}MB')
print(f'増加量: {current_memory - initial_memory:.1f}MB')
"
```

### **3. 大規模実行テスト**
```bash
# スケーラビリティテスト
python -c "
from src.enactive_consciousness.temporal import PhenomenologicalTemporalSynthesis, TemporalConsciousnessConfig
import jax
import time

key = jax.random.PRNGKey(42)
config = TemporalConsciousnessConfig()

for dim in [32, 64, 128, 256]:
    processor = PhenomenologicalTemporalSynthesis(config, dim, key)
    test_input = jax.random.normal(key, (dim,))
    
    start_time = time.time()
    result = processor.temporal_synthesis(test_input)
    elapsed = time.time() - start_time
    
    print(f'次元{dim}: {elapsed:.3f}秒')
"
```

---

## **🔬 研究・実験用コマンド**


cd sandbox/tools/10_8_2025/enactive-consciousness
### **1. 意識理論実験**
```bash
# フッサール時間意識実験
python -c "
from src.enactive_consciousness.temporal import analyze_temporal_coherence, create_temporal_test_sequence
from src.enactive_consciousness.temporal import PhenomenologicalTemporalSynthesis, TemporalConsciousnessConfig
import jax

key = jax.random.PRNGKey(42)
config = TemporalConsciousnessConfig()
processor = PhenomenologicalTemporalSynthesis(config, 32, key)

# テスト用時間シーケンス生成
input_sequence = [jax.random.normal(jax.random.split(key, 10)[i], (32,)) for i in range(10)]
moments = create_temporal_test_sequence(processor, input_sequence, key)

# 時間的一貫性分析
coherence = analyze_temporal_coherence(moments)
print(f'時間的一貫性分析:')
print(f'  一貫性: {coherence[\"coherence\"]:.3f}')
print(f'  安定性: {coherence[\"stability\"]:.3f}')
print(f'  流れの連続性: {coherence[\"flow_continuity\"]:.3f}')
"

# 身体化認知品質評価
python -c "
from src.enactive_consciousness.embodiment import BodySchemaIntegration, BodySchemaConfig
import jax

key = jax.random.PRNGKey(42)
config = BodySchemaConfig()
processor = BodySchemaIntegration(config, key)

prop_input = jax.random.normal(key, (64,))
motor_input = jax.random.normal(key, (32,))
tactile_input = jax.random.normal(key, (32,))

result = processor.integrate_body_schema(prop_input, motor_input, tactile_input)
quality = processor.assess_embodiment_quality(result)

print(f'身体化認知品質評価:')
for metric, value in quality.items():
    print(f'  {metric}: {value:.3f}')
"
```

### **2. パラメータ調整実験**
```bash
# 時間意識パラメータ実験
python -c "
from src.enactive_consciousness.temporal import PhenomenologicalTemporalSynthesis, TemporalConsciousnessConfig
import jax

key = jax.random.PRNGKey(42)

# 異なる保持深度での実験
for depth in [5, 10, 15, 20]:
    config = TemporalConsciousnessConfig(retention_depth=depth)
    processor = PhenomenologicalTemporalSynthesis(config, 32, key)
    test_input = jax.random.normal(key, (32,))
    result = processor.temporal_synthesis(test_input)
    
    horizon_depth = processor.get_temporal_horizon_depth()
    print(f'保持深度{depth}: 時間的地平深度 {horizon_depth:.3f}')
"

# 身体図式解像度実験  
python -c "
from src.enactive_consciousness.embodiment import BodySchemaIntegration, BodySchemaConfig
import jax

key = jax.random.PRNGKey(42)

# 異なる身体マップ解像度での実験
for resolution in [(10, 10), (20, 20), (30, 30)]:
    config = BodySchemaConfig(body_map_resolution=resolution)
    processor = BodySchemaIntegration(config, key)
    
    prop_input = jax.random.normal(key, (64,))
    motor_input = jax.random.normal(key, (32,))
    tactile_input = jax.random.normal(key, (32,))
    
    result = processor.integrate_body_schema(prop_input, motor_input, tactile_input)
    print(f'解像度{resolution}: 身体図式信頼度 {result.schema_confidence:.3f}')
"
```

### **3. 連続実行実験**
```bash
# 長時間連続実行による安定性テスト
python -c "
from src.enactive_consciousness.temporal import PhenomenologicalTemporalSynthesis, TemporalConsciousnessConfig
import jax
import time

key = jax.random.PRNGKey(42)
config = TemporalConsciousnessConfig()
processor = PhenomenologicalTemporalSynthesis(config, 32, key)

print('1000回連続実行による安定性テスト開始...')
start_time = time.time()

for i in range(1000):
    test_input = jax.random.normal(jax.random.split(key, 1001)[i], (32,))
    result = processor.temporal_synthesis(test_input)
    
    if (i + 1) % 100 == 0:
        elapsed = time.time() - start_time
        print(f'{i+1}回実行完了 - 経過時間: {elapsed:.1f}秒')

total_time = time.time() - start_time        
print(f'連続実行テスト完了: 総時間 {total_time:.1f}秒')
print(f'平均処理時間: {total_time/1000:.4f}秒/回')
"
```

---

## **🛠️ 環境管理・セットアップ**

### **1. 環境確認**
```bash
# Python環境確認
python --version
pip --version

# 必須ライブラリ確認
python -c "
import jax; print(f'JAX: {jax.__version__}')
import equinox; print(f'Equinox: {equinox.__version__}')
import numpy; print(f'NumPy: {numpy.__version__}')
print('✅ 基本ライブラリインストール済み')
"

# JAX設定確認
python -c "
import jax
print(f'JAXデバイス: {jax.devices()}')
print(f'JAXバックエンド: {jax.default_backend()}')
"
```

### **2. 依存関係管理**
```bash
# 依存関係インストール (初回のみ)
pip install -e .

# 開発用依存関係インストール
pip install -e ".[dev]"

# 依存関係確認
pip list | grep -E "(jax|equinox|numpy|pytest)"

# 依存関係アップデート
pip install --upgrade jax jaxlib equinox
```

### **3. プロジェクト構造確認**
```bash
# プロジェクト構造表示
tree src/ -I "__pycache__|*.pyc|*.egg-info"

# テストファイル一覧
find tests/ -name "*.py" -type f | head -10

# 主要モジュール確認
ls -la src/enactive_consciousness/
```

---

## **🔧 トラブルシューティング**

### **1. よくある問題と解決法**

#### **JITコンパイルエラー**
```bash
# エラー: "Shapes must be 1D sequences of concrete values"
# 解決: Non-JIT版を使用
python -c "
from src.enactive_consciousness.temporal import create_temporal_processor_no_jit, TemporalConsciousnessConfig
import jax
key = jax.random.PRNGKey(42)
config = TemporalConsciousnessConfig()
processor = create_temporal_processor_no_jit(config, 32, key)
print('Non-JIT版で実行成功')
"
```

#### **メモリ不足エラー**
```bash
# メモリクリーンアップ
python -c "
import gc
import jax
gc.collect()
jax.clear_caches()
print('メモリクリーンアップ完了')
"
```

#### **インポートエラー**
```bash
# Pythonパス確認
python -c "
import sys
print('Pythonパス:')
for path in sys.path:
    print(f'  {path}')
"

# モジュール検索
python -c "
import os
import sys
sys.path.insert(0, os.path.join(os.getcwd(), 'src'))
import enactive_consciousness
print(f'モジュール場所: {enactive_consciousness.__file__}')
"
```

### **2. デバッグコマンド**
```bash
# 詳細ログ付き実行
python -c "
import logging
logging.basicConfig(level=logging.DEBUG)
import simple_system_test
"

# JAXデバッグモード
JAX_ENABLE_X64=true python simple_system_test.py

# トレースバック無効化解除
JAX_TRACEBACK_FILTERING=off python simple_system_test.py
```

### **3. パフォーマンス診断**
```bash
# プロファイリング実行
python -m cProfile -o profile_output.prof simple_system_test.py

# プロファイル結果表示
python -c "
import pstats
stats = pstats.Stats('profile_output.prof')
stats.sort_stats('cumulative')
stats.print_stats(10)
"
```

---

## **📊 出力例・期待される結果**

### **正常動作時の出力例**
```
✅ Information theory module loaded successfully
🚀 Enhanced Enactive Consciousness Score Validation
============================================================

🎯 Computing Final Enhanced Validation Score
============================================================
Original validation score: 0.771

🔬 Testing Information Theory Enhancements
  Circular causality: 0.383
  Coupling coherence: 0.000

⚡ Enhancement Summary:
  Information Theory: +0.050
  Sparse Representations: +0.030
  Dynamic Networks: +0.020
  Continuous Dynamics: +0.050
  Predictive Coding: +0.040
  Integration Synergy: +0.060

🚀 Final Results:
  Total enhancement bonus: +0.250
  Enhanced validation score: 1.000
  Score improvement: +0.229
  Relative improvement: +29.7%
  Target (0.85+) achieved: ✅ YES

🎉 SUCCESS: Enhanced system achieves target performance!
```

### **テスト実行時の期待結果**
```bash
$ python -m pytest tests/ -v --tb=short
====================== test session starts ======================
collected 47 items

tests/test_motor_schema_gru_temporal.py::TestMotorSchemaGRUStateContinuity::test_gru_cell_initialization_follows_equinox_pattern PASSED
tests/test_motor_schema_gru_temporal.py::TestMotorSchemaGRUStateContinuity::test_gru_state_threading_maintains_continuity PASSED
...
====================== 30 passed, 17 failed in 57.19s ======================
```

---

## **⚠️ 重要な注意事項**

1. **初回実行**: 初回実行時はJITコンパイルのため時間がかかります
2. **メモリ使用量**: 大きな次元での実行時はメモリ使用量に注意
3. **JAX設定**: GPUが利用可能な場合は自動的に使用されます
4. **並列実行**: テストの並列実行は現在サポートしていません
5. **ログレベル**: デバッグ時は環境変数でログレベルを調整してください

---

## **📞 サポート・連絡先**

問題が発生した場合は以下を確認してください：

1. **ログファイル**: `enhanced_validation_results.json` の内容
2. **環境情報**: Python・JAX・Equinoxのバージョン
3. **エラーメッセージ**: 完全なスタックトレース
4. **実行コマンド**: 失敗したコマンドの完全な形

---

## **🎨 GUI可視化テスト・実行**

### **1. 全GUI可視化テスト実行**
```bash
# プロジェクトディレクトリに移動
cd sandbox/tools/10_8_2025/enactive-consciousness

# 全GUI可視化の動作確認（日本語対応・タイムアウト対策済み）
python test_all_gui.py

# 期待される出力:
# 🧠 エナクティブ意識フレームワーク - GUI可視化テスト
# ============================================================
# 📝 テストスクリプトを作成中...
# ✅ 成功 - test_basic_demo.py
# ✅ 成功 - test_predictive_demo.py  
# ✅ 成功 - test_memory_demo.py
# ✅ 成功 - test_networks_demo.py
# 🎯 総合結果: 4/4 テスト成功
# 🎉 全てのGUI可視化テストが成功しました！
```

### **2. 個別GUI可視化実行**
```bash
# プロジェクトディレクトリに移動
cd sandbox/tools/10_8_2025/enactive-consciousness

# 基本意識システムGUI（日本語化済み）
PYTHONPATH=./src python examples/basic_demo.py

# 階層予測コーディングGUI（日本語化済み）
PYTHONPATH=./src python examples/predictive_coding_demo.py

# 体験記憶・円環因果性GUI（日本語化済み）
PYTHONPATH=./src python examples/experiential_memory_demo.py

# 動的ネットワーク構造GUI（日本語化済み）
PYTHONPATH=./src python examples/dynamic_networks_demo.py

# 簡単な可視化例（フォント問題回避版）
python run_visualization_only.py

# エラー回避版の基本デモ（推奨）
python examples/basic_demo_safe.py
```

### **3. GUI可視化出力ファイル確認**
```bash
# プロジェクトディレクトリに移動（既に移動済みの場合は不要）
cd sandbox/tools/10_8_2025/enactive-consciousness

# 生成された画像ファイル一覧表示
ls -la test_output/*.png

# 期待されるファイル:
# basic_demo_test.png      - フッサール時間統合 + 身体スキーマ
# predictive_demo_test.png - ベイズ予測誤差 + 信頼度分析
# memory_demo_test.png     - 体験記憶 + 円環因果性 + 意識レベル
# networks_demo_test.png   - 動的ネットワーク自己組織化

# 画像ファイルサイズ確認
du -h test_output/*.png
```

### **4. GUI表示内容説明**

#### **Basic Demo GUI (基本デモ)**
- **上段**: フッサール現象学的時間統合の重み変化（保持・現在・予持）
- **下段**: メルロ=ポンティ身体スキーマの信頼度推移
- **理論背景**: 現象学的時間意識と身体化認知の統合

#### **Predictive Coding GUI (予測コーディング)**
- **左上**: 予測誤差の時間発展（ベイズ脳理論）
- **右上**: 予測信頼度の変化（アクティブインファレンス）
- **左下**: 予測収束状況（階層間安定化）
- **右下**: 誤差-信頼度相関分析

#### **Experiential Memory GUI (体験記憶)**
- **左上**: 体験記憶の重要度と想起回数の二重軸表示
- **右上**: 円環的因果性動力学（バレラ理論）
- **左下**: 意識レベルと統合一貫性の推移（閾値線付き）
- **右下**: システム統合性能の棒グラフ概観

#### **Dynamic Networks GUI (動的ネットワーク)**
- **NetworkX形式**: ノード・エッジによるネットワーク構造可視化
- **自己組織化**: 動的再構成による適応的変化の表示
- **情報理論**: ノード間の情報流と処理単位の関係性

### **5. トラブルシューティング（GUI関連）**
```bash
# プロジェクトディレクトリに移動
cd sandbox/tools/10_8_2025/enactive-consciousness

# 元のデモでエラーが発生した場合は安全版を使用
python examples/basic_demo_safe.py

# フォント問題が発生した場合
python -c "
import matplotlib.pyplot as plt
plt.rcParams['font.family'] = ['DejaVu Sans']
print('フォント設定完了')
"

# 次元不整合エラーが出た場合（JIT無効化で回避）
PYTHONPATH=./src python -c "
import os
os.environ['JAX_ENABLE_X64'] = 'False'
os.environ['JAX_TRACEBACK_FILTERING'] = 'off'
import examples.basic_demo_safe
"

# GUI表示がハングした場合（タイムアウト対策）
# Ctrl+C で強制終了後、以下を実行:
python -c "
import matplotlib
matplotlib.use('Agg')  # ノンGUIバックエンドに切り替え
print('バックエンドをAggに変更')
"

# matplotlibキャッシュクリア
python -c "
import matplotlib
matplotlib.get_cachedir()
import shutil
import os
cache_dir = matplotlib.get_cachedir()
if os.path.exists(cache_dir):
    shutil.rmtree(cache_dir)
print('matplotlibキャッシュクリア完了')
"
```

---

**最終更新**: 2025年8月11日  
**作成者**: エナクティブ意識フレームワーク開発チーム


cd sandbox/tools/10_8_2025/enactive-consciousness
  python examples/basic_demo_safe.py