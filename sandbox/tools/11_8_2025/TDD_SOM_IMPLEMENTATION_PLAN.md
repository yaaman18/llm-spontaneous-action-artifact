# SOMå®Ÿè£…TDDæˆ¦ç•¥ãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: ã‚¨ãƒŠã‚¯ãƒ†ã‚£ãƒ–æ„è­˜ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ç”¨SOMå®Ÿè£…  
**TDDæŒ‡å°åŸç†**: å’Œç”°å“äººï¼ˆt_wadaï¼‰ã®ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºæ‰‹æ³•  
**æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**: JAX + pytest + hypothesis  

---

## ğŸ“‹ TDDå®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºã¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### **Phase 1: BMUè¨ˆç®—ã®TDD (å„ªå…ˆåº¦: æœ€é«˜)**

**æœŸé–“**: 2-3æ—¥  
**Red-Green-Refactor ã‚µã‚¤ã‚¯ãƒ«**: 3-4å›è»¢äºˆå®š

#### **Red Stage (å¤±æ•—ãƒ†ã‚¹ãƒˆä½œæˆ)**
- [ ] âœ… åŸºæœ¬BMUæ¤œç´¢å¤±æ•—ãƒ†ã‚¹ãƒˆ (`test_som_tdd_phase1.py`)
- [ ] âœ… è·é›¢è¨ˆç®—ç²¾åº¦å¤±æ•—ãƒ†ã‚¹ãƒˆ
- [ ] âœ… å¢ƒç•Œæ¡ä»¶å‡¦ç†å¤±æ•—ãƒ†ã‚¹ãƒˆ  
- [ ] âœ… JAXäº’æ›æ€§å¤±æ•—ãƒ†ã‚¹ãƒˆ

#### **Green Stage (æœ€å°å®Ÿè£…)**
```python
# å®Ÿè£…äºˆå®š: sandbox/tools/11_8_2025/som_bmu_jax.py
@jax.jit
def find_bmu_basic(weights: jnp.ndarray, input_vector: jnp.ndarray) -> Tuple[int, int]:
    """æœ€å°é™ã®BMUå®Ÿè£…ï¼ˆJITæœ€é©åŒ–å‰ï¼‰"""
    distances = jnp.linalg.norm(weights - input_vector, axis=2)
    return jnp.unravel_index(jnp.argmin(distances), weights.shape[:2])
```

#### **Refactor Stage (æœ€é©åŒ–)**
- [ ] JAX JITæœ€é©åŒ–é©ç”¨
- [ ] vmap ã«ã‚ˆã‚‹ä¸¦åˆ—åŒ–
- [ ] ãƒ¡ãƒ¢ãƒªåŠ¹ç‡æ”¹å–„
- [ ] æ•°å€¤å®‰å®šæ€§å‘ä¸Š

**å®Œäº†åŸºæº–**:
- [ ] BMUæ¤œç´¢ç²¾åº¦100% (ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹100ä»¶)
- [ ] å®Ÿè¡Œæ™‚é–“ < 1ms (64x64ãƒãƒƒãƒ—, 100æ¬¡å…ƒå…¥åŠ›)
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ < 10MB
- [ ] æ—¢å­˜ãƒ†ã‚¹ãƒˆç ´ç¶»ãªã—

---

### **Phase 2: é‡ã¿æ›´æ–°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ TDD (å„ªå…ˆåº¦: é«˜)**

**æœŸé–“**: 3-4æ—¥  
**ä¾å­˜**: Phase 1å®Œäº†

#### **Red Stage**
- [ ] å­¦ç¿’ç‡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¤±æ•—ãƒ†ã‚¹ãƒˆ
- [ ] è¿‘å‚é–¢æ•°è¨ˆç®—å¤±æ•—ãƒ†ã‚¹ãƒˆ
- [ ] æ™‚é–“æ¸›è¡°æ©Ÿèƒ½å¤±æ•—ãƒ†ã‚¹ãƒˆ
- [ ] äºˆæ¸¬ç¬¦å·åŒ–çµ±åˆå¤±æ•—ãƒ†ã‚¹ãƒˆ

#### **Green Stage** 
```python
# å®Ÿè£…äºˆå®š: sandbox/tools/11_8_2025/som_weight_update.py
@jax.jit
def update_weights_basic(weights, input_vector, bmu_coords, learning_rate, sigma):
    """åŸºæœ¬çš„ãªé‡ã¿æ›´æ–°å®Ÿè£…"""
    # ã‚¬ã‚¦ã‚·ã‚¢ãƒ³è¿‘å‚é–¢æ•°
    # é‡ã¿æ›´æ–°ãƒ«ãƒ¼ãƒ«
    # è¿”ã‚Šå€¤: æ›´æ–°ã•ã‚ŒãŸé‡ã¿
```

#### **Refactor Stage**
- [ ] ãƒãƒƒãƒæ›´æ–°å¯¾å¿œ
- [ ] é©å¿œçš„å­¦ç¿’ç‡
- [ ] è¿‘å‚å½¢çŠ¶æœ€é©åŒ–

**å®Œäº†åŸºæº–**:
- [ ] åæŸæ€§èƒ½ãƒ†ã‚¹ãƒˆåˆæ ¼
- [ ] æ•°å€¤å®‰å®šæ€§ç¢ºä¿
- [ ] å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿å¯¾å¿œ (10ä¸‡ã‚µãƒ³ãƒ—ãƒ«)

---

### **Phase 3: ã‚¨ãƒŠã‚¯ãƒ†ã‚£ãƒ–çµ±åˆTDD (å„ªå…ˆåº¦: é«˜)**

**æœŸé–“**: 4-5æ—¥  
**ä¾å­˜**: Phase 1-2å®Œäº† + æ—¢å­˜äºˆæ¸¬ç¬¦å·åŒ–ã‚·ã‚¹ãƒ†ãƒ é€£æº

#### **Red Stage**
- [ ] âœ… äºˆæ¸¬ç¬¦å·åŒ–çµ±åˆå¤±æ•—ãƒ†ã‚¹ãƒˆ (`test_som_predictive_integration.py`)
- [ ] âœ… ç¾è±¡å­¦çš„å“è³ªè¨ˆç®—å¤±æ•—ãƒ†ã‚¹ãƒˆ
- [ ] âœ… æ™‚é–“çš„ä¸€è²«æ€§å¤±æ•—ãƒ†ã‚¹ãƒˆ
- [ ] âœ… Î¦å€¤å¯„ä¸åº¦è¨ˆç®—å¤±æ•—ãƒ†ã‚¹ãƒˆ

#### **Green Stage**
```python
# å®Ÿè£…äºˆå®š: sandbox/tools/11_8_2025/som_enactive_integration.py
class EnactiveConsciousnessIntegration:
    def process_predictive_state(self, predictive_state, som_state):
        """äºˆæ¸¬çŠ¶æ…‹ã¨SOMçŠ¶æ…‹ã®çµ±åˆå‡¦ç†"""
        
    def compute_consciousness_contribution(self):
        """æ„è­˜ãƒ¬ãƒ™ãƒ«ã¸ã®å¯„ä¸åº¦è¨ˆç®—"""
        
    def update_phenomenological_quality(self):
        """ç¾è±¡å­¦çš„å“è³ªã®æ›´æ–°"""
```

#### **Refactor Stage**
- [ ] æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®æœ€é©åŒ–çµ±åˆ
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†å¯¾å¿œ
- [ ] ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š

**å®Œäº†åŸºæº–**:
- [ ] æ—¢å­˜äºˆæ¸¬ç¬¦å·åŒ–ãƒ†ã‚¹ãƒˆ 100% pass
- [ ] æ„è­˜ãƒ¬ãƒ™ãƒ«è¨ˆç®—ç²¾åº¦å‘ä¸Š (ç¾è¡Œæ¯”+10%)
- [ ] çµ±åˆå‡¦ç†é…å»¶ < 5ms

---

## ğŸ”§ JAX JITæœ€é©åŒ–æˆ¦ç•¥

### **æœ€é©åŒ–ãƒ¬ãƒ™ãƒ«æ®µéš**

1. **Level 1: åŸºæœ¬JITé©ç”¨**
   ```python
   @jax.jit
   def basic_function(x): return jnp.sum(x**2)
   ```

2. **Level 2: vmapä¸¦åˆ—åŒ–**
   ```python
   batch_function = jax.vmap(basic_function)
   ```

3. **Level 3: ãƒ‡ãƒã‚¤ã‚¹æœ€é©åŒ–**
   ```python
   @jax.jit
   @partial(jax.pmap, axis_name='batch')
   def distributed_function(x): return basic_function(x)
   ```

### **æ€§èƒ½ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ç›®æ¨™**

| æ©Ÿèƒ½ | ç›®æ¨™å®Ÿè¡Œæ™‚é–“ | ç›®æ¨™ãƒ¡ãƒ¢ãƒª | JITåŠ¹æœ |
|------|-------------|-----------|---------|
| BMUæ¤œç´¢ (64x64) | < 1ms | < 10MB | 10xé«˜é€ŸåŒ– |
| é‡ã¿æ›´æ–° (1000ã‚µãƒ³ãƒ—ãƒ«) | < 50ms | < 100MB | 5xé«˜é€ŸåŒ– |
| çµ±åˆå‡¦ç† | < 5ms | < 20MB | 3xé«˜é€ŸåŒ– |

---

## ğŸ§ª æ—¢å­˜ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ çµ±åˆæ–¹é‡

### **éç ´å£Šçµ±åˆåŸå‰‡**
1. **æ—¢å­˜ãƒ†ã‚¹ãƒˆç¶­æŒ**: å…¨ã¦ã®æ—¢å­˜ãƒ†ã‚¹ãƒˆãŒå¼•ãç¶šãæˆåŠŸ
2. **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä¿æŒ**: å…¬é–‹APIã®ç ´å£Šçš„å¤‰æ›´ç¦æ­¢
3. **æ®µéšçš„çµ±åˆ**: æ©Ÿèƒ½æ¯ã®å€‹åˆ¥çµ±åˆã§å½±éŸ¿ç¯„å›²é™å®š

### **çµ±åˆãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ**
```bash
# Phaseå®Œäº†æ™‚ã«å®Ÿè¡Œã™ã‚‹çµ±åˆç¢ºèªã‚³ãƒãƒ³ãƒ‰
pytest tests/unit/domain/ -v --tb=short
pytest tests/integration/ -v --maxfail=3 
pytest sandbox/tools/11_8_2025/tests/ -v -m "not slow"
```

### **çµ±åˆãƒ†ã‚¹ãƒˆãƒãƒˆãƒªã‚¯ã‚¹**

| æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ  | çµ±åˆãƒ¬ãƒ™ãƒ« | ãƒ†ã‚¹ãƒˆæ•° | æˆåŠŸåŸºæº– |
|-------------|-----------|---------|----------|
| äºˆæ¸¬ç¬¦å·åŒ– | æ·±åº¦çµ±åˆ | 50+ | 95%+ pass |
| Î¦å€¤è¨ˆç®— | ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµ±åˆ | 20+ | 100% pass |
| æ„è­˜çŠ¶æ…‹ | ãƒ‡ãƒ¼ã‚¿çµ±åˆ | 30+ | 98%+ pass |
| æ™‚é–“çš„ä¸€è²«æ€§ | éƒ¨åˆ†çµ±åˆ | 15+ | 90%+ pass |

---

## ğŸ“Š TDDé€²æ—ç®¡ç†

### **ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ç®¡ç†**
```python
# é€²æ—ç¢ºèªãƒ†ã‚¹ãƒˆ: tests/test_tdd_progress.py
def test_phase1_milestone():
    assert all([
        bmu_implementation_complete(),
        performance_targets_met(), 
        integration_tests_pass()
    ])

def test_phase2_milestone():
    # Phase2å®Œäº†åŸºæº–
    
def test_phase3_milestone():
    # Phase3å®Œäº†åŸºæº–
```

### **å“è³ªã‚²ãƒ¼ãƒˆ**
å„Phaseå®Œäº†å‰ã«ä»¥ä¸‹ã‚’æº€ãŸã™å¿…è¦ãŒã‚ã‚‹ï¼š

1. **ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸**: 90%ä»¥ä¸Š
2. **ãƒ†ã‚¹ãƒˆæˆåŠŸç‡**: Phaseå†…95%ä»¥ä¸Š, æ—¢å­˜90%ä»¥ä¸Š
3. **æ€§èƒ½è¦ä»¶**: ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯åŸºæº–ã‚¯ãƒªã‚¢
4. **ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼**: TDDåŸå‰‡æº–æ‹ ç¢ºèª

---

## ğŸš€ å®Ÿè¡Œæ‰‹é †

### **Day 1: ç’°å¢ƒæ•´å‚™ + Phase1 Red**
```bash
# 1. ãƒ†ã‚¹ãƒˆç’°å¢ƒç¢ºèª
cd /Users/yamaguchimitsuyuki/omoikane-lab/sandbox/tools/11_8_2025
python -m pytest tests/test_som_tdd_phase1.py -v -x

# 2. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install jax jaxlib hypothesis

# 3. Red Stageå®Ÿè¡Œï¼ˆã™ã¹ã¦å¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
python -m pytest tests/test_som_tdd_phase1.py -m "unit" -x
```

### **Day 2-3: Phase1 Green + Refactor**
```bash
# 1. æœ€å°å®Ÿè£…ã§ãƒ†ã‚¹ãƒˆã‚’é€šã™
# - som_bmu_jax.py ã®åŸºæœ¬å®Ÿè£…
# - ãƒ†ã‚¹ãƒˆ1ã¤ãšã¤é€šã—ãªãŒã‚‰æ©Ÿèƒ½è¿½åŠ 

# 2. Refactor ã§æœ€é©åŒ–
# - JAX JITé©ç”¨
# - æ€§èƒ½è¦ä»¶ç¢ºèª
```

### **Day 4-7: Phase2å®Ÿè¡Œ**
```bash
# Phase1å®Œäº†å¾Œã«Phase2é–‹å§‹
python -m pytest tests/test_som_weight_update.py
```

### **Day 8-12: Phase3å®Ÿè¡Œ**
```bash 
# Phase2å®Œäº†å¾Œã«Phase3é–‹å§‹
python -m pytest tests/test_som_predictive_integration.py
```

---

## âš ï¸ ãƒªã‚¹ã‚¯ç®¡ç†

### **æŠ€è¡“ãƒªã‚¹ã‚¯**
1. **JAXäº’æ›æ€§å•é¡Œ**: æ—¢å­˜NumPyã‚³ãƒ¼ãƒ‰ã¨ã®äº’æ›æ€§
   - **è»½æ¸›ç­–**: æ®µéšçš„ç§»è¡Œã¨fallbackå®Ÿè£…
2. **æ€§èƒ½è¦ä»¶æœªé”**: JITæœ€é©åŒ–åŠ¹æœä¸è¶³
   - **è»½æ¸›ç­–**: ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°é§†å‹•æœ€é©åŒ–
3. **æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ç ´ç¶»**: çµ±åˆæ™‚ã®äºˆæœŸã—ãªã„å‰¯ä½œç”¨
   - **è»½æ¸›ç­–**: åŒ…æ‹¬çš„å›å¸°ãƒ†ã‚¹ãƒˆ

### **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒªã‚¹ã‚¯**
1. **Phaseé–“ä¾å­˜**: å‰æ®µéšã®é…ã‚ŒãŒå¾Œç¶šã«å½±éŸ¿
   - **è»½æ¸›ç­–**: ä¸¦è¡Œä½œæ¥­å¯èƒ½ãªéƒ¨åˆ†ã®ç‰¹å®š
2. **è¤‡é›‘æ€§éå°è©•ä¾¡**: çµ±åˆã®æŠ€è¡“çš„è¤‡é›‘ã•
   - **è»½æ¸›ç­–**: æ®µéšçš„çµ±åˆã¨MVPå¿—å‘

---

## ğŸ“ˆ æˆåŠŸåŸºæº–

### **æœ€çµ‚ç›®æ¨™**
- [ ] **æ©Ÿèƒ½**: SOM + äºˆæ¸¬ç¬¦å·åŒ– + Î¦å€¤è¨ˆç®—ã®å®Œå…¨çµ±åˆ
- [ ] **æ€§èƒ½**: æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ æ¯”ã§2-10xé«˜é€ŸåŒ–
- [ ] **å“è³ª**: ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸90%ä»¥ä¸Š, æ—¢å­˜ãƒ†ã‚¹ãƒˆç ´ç¶»ãªã—
- [ ] **ä¿å®ˆæ€§**: TDDåŸå‰‡ã«åŸºã¥ãé«˜å“è³ªã‚³ãƒ¼ãƒ‰

### **æ¤œè¨¼æ–¹æ³•**
```bash
# æœ€çµ‚çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
python -m pytest tests/ sandbox/tools/11_8_2025/tests/ -v --cov=./ --cov-report=html
python -c "
import sandbox.tools.11_8_2025.enactive_som as som
framework = som.EnactiveConsciousnessFramework()
# ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
"
```

---

**å®Ÿè£…é–‹å§‹**: Ready to GO! ğŸ¯  
**TDDåŸå‰‡**: Red â†’ Green â†’ Refactor  
**å“è³ªä¿è¨¼**: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ç¢ºå®Ÿãªå®Ÿè£…ã‚’ç›®æŒ‡ã™